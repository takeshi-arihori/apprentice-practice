# ブラックジャックゲーム

このプロジェクトでは、これまで学んだことを使って、通称「21」とも呼ばれる「ブラックジャック」アプリケーションを作成しながら、ソフトウェア設計のトレーニングを行っていきます。ソフトウェア設計は非常に大事で、設計さえしっかり組んでおけば、ブラックジャックだけでなく、他のトランプゲームにも対応することができるようになります。    

  
ソフトウェアの設計はコードを書くことではありません。設計はコードの 1 行目が書かれる前に行われる重要なステップであり、これによって時間と労力を大幅に節約することができます。


強力なソフトウェア設計には、
- 目標を明確にすること
- 適したツールやテンプレートを選択すること
- 機能を追加、削除、拡張するための柔軟性を確保すること
- 実装を迅速かつ効率的に行うためにシンプルかつ良質にすること
など、多くのことが含まれます。


チーム、プロジェクト、予算などの多くの要因に応じて、設計に変更を加えなければいけない可能性もありますし、最初から最後までこだわった設計を作成する可能性もあります。設計はできるだけシンプル、モジュール化（標準化）を意識し、目的を達成しなければいけません。


### ブラックジャックのゲーム概要
通常、設計を決定する前には、目標や問題をしっかり理解しておく必要があります。今回の場合は「ブラックジャックのルールの理解」になります。


ブラックジャックは、52枚のトランプを使ったカードゲームで、カードは「クラブ」「ダイヤモンド」「ハート」「スペード」の 4 種類のスート（絵柄マーク）に分かれており、各スートには 13 のランク（番号の札）があります。13 のランクは、`A（エース）, 2, 3, 4, 5, 6, 7, 8, 9, 10, J（ジャック）, Q（クイーン）, K（キング）`となっています。


1 テーブルは、カジノを表す「ハウス」と、5 - 7 人のプレイヤーによって構成されます。各プレイヤーはハウスとの間で 1 対 1 の勝負を行います。つまり、ハウスは複数のプレーヤーと同時に勝負をすることになります。


各プレイヤーの目標は、21 を超えないようにハンド（手持ちのカード）の点数の合計を 21 に近づけ、その点数がハウスのハンドを上回ることです。手札のカードの点数は、カード 2 - 10 ではその数字通りの値であり、絵札である K（キング）, Q（クイーン）, J（ジャック）は 10 と数えます。A（エース）は、1 と 11 のどちらか、都合のよい方で数えることができます。例えば、プレイヤーのハンドが（A,K）の場合、A は 11、K は 10 とカウントできます。


各プレイヤーはチップを持っていて、それを各ターンベットすることができます。ブラックジャックは以下の 4 つのフェーズのサイクルによって構成されています。

1. ベット
ゲームが始まる前に各プレーヤーが 1 ゲームに賭ける金額をテーブルにベットします。

2. カードの入手
ハウスは各プレイヤーに 2 枚ずつカードを配ります。ハウスは、1 枚のカードを表向きに、1 枚を裏向きにします。

3. アクション
各プレイヤーは手札を変えるさまざまなアクションを取ることができます。このアクションが全て終了した後に、ハウスは裏向きのカードを表向きにします。

4. 評価
各プレイヤーはハウスと最後に残った手札を比較し、スコアに応じてチップの勝ち負けを判断します。このフェーズが終わると、次のラウンドはまたベットから始まります。

フェーズ 3 と 4 が複雑なので、以下より詳細に解説します。


### アクション
ハウスからカードを 2 枚入手した後、各プレイヤーはさまざまなアクションを取ることができます。アクションフェーズでは、プレイヤーはラウンドロビン形式で手札を維持するか調整するかのどちらかのオプションから選択します。

### 最初のラウンドでプレイヤーができるアクション
- サレンダー
最初に配られた 2 枚のカードの時点で、プレイヤーが自ら負けを認めること。サレンダーした場合には、ゲームに賭けた金額の半分が戻ってきます。

- スタンド
カードの追加をストップし、現在のハンド（手元にあるカード）で勝負をすること。

- ヒット
手札に更に 1 枚のカードを追加すること。手札の合計が 21 を超えてしまうことをバスト（bust）と呼び、直ちにプレイヤーの負けとなってしまうので注意が必要です。

- ダブル
ベットを 2 倍にして、もう 1 枚だけカードを引くことができます。このアクションは最初に 2 枚カードが配られた後しか行うことはできません。

### もし、プレイヤーがヒットした後にバストしなかった場合
- ヒット
プレイヤーはもう一度ヒットすることができます。プレイヤーは 21 を超えなければ何回でもヒットすることができます。

- スタンド
カードの追加をストップし、現在のハンド（手元にあるカード）で勝負することができます。

各プレイヤーの全ての行動が終了したタイミング（バスト、スタンド、サレンダー、ダブル）で、ハウスは裏向きのカードを公開し、それが 17 以上であればスタンド、そうでなければ、17 以上になるまでカードを引き続けなければなりません。



### 評価
評価のフェーズでは、バストしておらず、チップがまだ残っている各プレイヤーの手札とディーラの手札を比較します。プレイヤーのカードの合計値がハウスのカードの合計値よりも高い場合、またはハウスがバストした場合はプレイヤーの勝ちとなります。


また、ハウスのカードがプレイヤーのカードよりも高い場合は、プレイヤーの負けになります。プレイヤーとハウスのカードの値が等しい場合、「プッシュ」と呼ばれます。この場合、ベットしたチップは失われません。


1 つだけ例外のケースが存在します。それは「ブラックジャック」と呼ばれ、プレイヤーの手札が 2 枚のみで、そのうちの 1 枚が「エース」で、もう 1 枚が「フェースカード（ジャック、クイーン、キング）」の場合です。これは他のブラックジャック以外の全ての手札を打ち負かすことができる最強の手札です。ブラックジャックは（3,8,K）のような合計値が 21 の手札さえ打ち負かすことができます。


以下のようにチップが調整されます。

- ハウスがブラックジャックの場合
- - プレイヤーがブラックジャックの場合、「プッシュ」になります。
- - プレイヤーがブラックジャックではない場合
- - - プレイヤーがダブルの場合、ベット額の 2 倍を失います。
- - - プレイヤーがスタンドの場合、ベット額の 1 倍を失います。

- ハウスがバスト、またはプレイヤーの手札がディーラの手札よりも大きい場合
- - プレイヤーがブラックジャックの場合、ベット額の 1.5 倍を手に入れます。
- - プレイヤーがダブルの場合、ベット額の 2 倍を手に入れます。
- - プレイヤーがスタンドの場合、ベット額の 1 倍を手に入れます。

- ハウスがバストしておらず、ハウスの手札がプレイヤーの手札より大きい場合
- - プレイヤーがダブルの場合、ベット額の 2 倍を失います。
- - プレイヤーがスタンドの場合、ベット額の 1 倍を失います。
ハウスとプレイヤーの手札が等しい他のケースでは、チップに影響をもたらしません。


以上が、フロンドエンドのデザインや設計に必要なブラックジャックのゲームフローです。
